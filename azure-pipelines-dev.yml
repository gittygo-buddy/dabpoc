# trigger:
#   branches:
#     include:
#       - main

pool:
  vmImage: 'ubuntu-latest'


variables:
- group: dev

  # DATABRICKS_HOST: 'https://adb-550289489940613.13.azuredatabricks.net/'

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.x'
  displayName: 'Set up Python'

- script: |
    python --version
    python -m pip install --upgrade pip
    pip --version
    pip install uv
    uv --version
  displayName: 'Install uv via pip and show versions'

- task: AzureCLI@2
  inputs:
    azureSubscription: 'dab_poc'
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      set -e  # Exit on first error

      # Install Databricks CLI v2
      curl -fsSL https://raw.githubusercontent.com/databricks/setup-cli/main/install.sh | sh

      # Confirm Databricks CLI version
      databricks --version
      # Authenticate using Azure CLI context
      databricks auth azure-login --host $(DATABRICKS_HOST)

      # Validate and deploy the asset bundle
      databricks bundle validate
      databricks bundle deploy --target dev
  displayName: 'Deploy Databricks Asset Bundle to Dev'
